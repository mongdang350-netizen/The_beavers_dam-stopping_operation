# 비버들의 댐막기 대작전 - Game Design Document (GDD)

> 이 문서는 AI Agent(Claude Code)가 장기간에 걸쳐 단계별로 구현할 수 있도록 작성된 종합 기획서입니다.
> 원본 기획: `plan.md` | 인터뷰 및 비평 피드백 반영 완료

---

## 1. 게임 개요

- **장르**: 타워 디펜스 (킹덤러쉬 스타일)
- **시점**: 3/4 뷰 (아이소메트릭 스타일, 약간 위에서 비스듬히 내려다보는 2D)
- **아트 스타일**: 카툰 스타일. 밝은 색상, 부드러운 선, 귀여움이 핵심
- **UI 언어**: 한국어
- **플랫폼**: 웹 브라우저 (PC 우선, 모바일 기본 지원)
- **참고 게임**: 킹덤러쉬 (Kingdom Rush)

### 핵심 컨셉
강 상류에서 사나워진 동물들이 흘러내려와 하류의 비버 댐을 파괴하려 한다. 플레이어는 강 옆 정해진 위치에 타워를 건설하여 동물들을 막고, 댐을 지켜야 한다.

---

## 2. 기술 스택

| 항목 | 선택 | 이유 |
|---|---|---|
| **게임 엔진** | Phaser 3 | 2D 웹 게임 특화, WebGL/Canvas 자동 전환, 스프라이트 배치 렌더링, 200+ 엔티티 검증됨 |
| **언어** | TypeScript (strict mode) | 타입 안전성, 대규모 리팩토링 용이, AI Agent 친화적 |
| **빌드** | Vite | 빠른 HMR, 간단한 설정 |
| **테스트** | Vitest | Vite 네이티브, Jest 호환 API |
| **린터** | ESLint (flat config) | 코드 품질 보장 |
| **포매터** | Prettier | 일관된 코드 스타일 |
| **CI** | GitHub Actions | 자동화된 테스트/빌드 파이프라인 |

### 개발 원칙
- **TDD**: 게임 로직은 반드시 테스트 먼저 작성
- **데이터 드리븐**: 모든 타워/적/스테이지 데이터는 JSON 외부 파일로 분리
- **게임 로직과 렌더링 분리**: 순수 TypeScript 클래스로 로직 구현, Phaser는 렌더링만 담당
- **모듈화**: 기능별 독립 모듈, 명확한 인터페이스
- **확장 가능**: 새 맵, 타워, 적, 난이도 모드, 멀티플레이어 등 모든 방향 확장 고려

---

## 3. 맵 & 진행 시스템

### 3.1 맵
- S자 구불구불한 강 경로
- 10스테이지 내내 **동일한 맵** 사용
- 타워 배치 슬롯: 강 옆 땅에 **6개 고정 위치**
- 댐: 강 끝(하단)에 위치

### 3.2 진행 구조
- **한 게임 = 10스테이지** 연속 플레이
- 스테이지 간 골드/타워 **유지**
- 각 스테이지 = 3 Wave
- Wave 진행: 이전 Wave의 모든 적 전멸 후 → 준비 시간 → 플레이어가 "다음 Wave 시작" 버튼 클릭
- 스테이지 간 전환: 자동 진행 (준비 시간 포함)
- 저장 기능: 없음 (한 번에 플레이)

### 3.3 댐
- **체력**: 200
- 적이 댐에 도달하면 **머물며 지속 공격** (적의 ATK × AS만큼 초당 데미지)
- 타워가 댐에 도달한 적을 공격하여 처치 가능
- 댐 체력 0 = **게임 오버**

### 3.4 별 평가 시스템
- 한 게임(10스테이지) 전체 기준
- **복합 평가 기준**:
  - 댐 잔여 체력 (가중치 50%)
  - 잔여 골드 (가중치 25%)
  - 클리어 시간 (가중치 25%)
- 점수 산출: `score = (dam_hp / 200) * 50 + (gold / max_gold) * 25 + (par_time / actual_time) * 25`
- 별 기준: 80점 이상 → 3별, 50점 이상 → 2별, 클리어 → 1별

---

## 4. 타워 시스템

### 4.1 공통 메커니즘
- **배치**: +버튼 클릭 → 팔레트 UI에서 4종 타워 선택 → 골드 차감 후 설치
- **업그레이드**: 설치된 타워 클릭 → 팔레트에서 2갈래 업그레이드 선택
- **판매**: 타워 클릭 → 판매 버튼 → **구매가의 50% 환불** (업그레이드 비용 포함)
- **타겟팅**: First (댐에 가장 가까운 적 = 경로상 가장 앞선 적 우선)

### 4.2 사거리 등급

| 등급 | 이름 | 반경 (타일) | 설명 |
|---|---|---|---|
| S | 근접 | 1.5 | 전사비버 교전 범위 |
| M | 중거리 | 3.5 | 기본 사거리 |
| L | 원거리 | 5.0 | 궁수 계열 |
| XL | 초장거리 | 7.0 | 박격포 |
| MAP | 전체 | 맵 전체 | - |

### 4.3 기본 타워 4종

| 타워 | 비용 | 공격타입 | ATK | AS | 사거리 | 대상 | 특징 |
|---|---|---|---|---|---|---|---|
| 궁수비버 | 100g | 물리 단일 | 8 | 2.0 | L (5.0) | 단일 | 새총, 빠른 공격속도 |
| 전사비버 | 110g | 물리 근접 | 5 | 1.0 | S (1.5) | 단일 | 병사 3마리 파견, 집결지점 |
| 마법사비버 | 130g | 마법 광역 | 12 | 1.0 | M (3.5) | 광역(반경 1.5) | 벼락, 최대 8체 동시 피해 |
| 폭탄비버 | 140g | 물리 광역 | 20 | 0.5 | M (3.5) | 광역(반경 2.0) | 폭탄 투척, 최대 12체 동시 피해 |

### 4.4 업그레이드 (2갈래씩)

#### 궁수비버 업그레이드

| 업그레이드 | 비용 | ATK | AS | 사거리 | 특수효과 |
|---|---|---|---|---|---|
| 블로우건수비버 | 160g | 10 | 3.0 | L (5.0) | 독: 초당 3 고정데미지, 5초 지속, 피격 시 독 타이머 초기화 |
| 쇠뇌수비버 | 150g | 13 | 1.5 | L (5.5) | 관통: 높은 단일 타겟 데미지 |

> **[비평 반영]** 쇠뇌수 AS를 1.5로 설정. 기본 궁수(AS 2.0)보다 느리지만 높은 데미지로 차별화.

#### 전사비버 업그레이드

| 업그레이드 | 비용 | 병사 수 | ATK | HP | DEF | MDEF | 특수효과 |
|---|---|---|---|---|---|---|---|
| 기사비버 | 150g | 3 | 9 | 100 | 15 | 0 | 도끼+방패, 강한 전투력 |
| 슈트비버 | 170g | 1 | 7 | 150 | 40 | 20 | 5초마다 반경 1.5 내 적 2초 기절 |

> **[비평 반영]** 기사 DEF 30→15로 하향 (Stage 5까지 무적 방지). 슈트비버에 ATK 7, HP 150 추가.

#### 마법사비버 업그레이드

| 업그레이드 | 비용 | 공격방식 | DPS | 사거리 | 특수효과 |
|---|---|---|---|---|---|
| 화염마법사비버 | 160g | 지속 화염방사 | 15 (초당) | M (3.5) | 반경 1.0 원뿔 범위, 지나가는 모든 적에게 지속 데미지 |
| 얼음마법사비버 | 150g | 마법 광역 | MATK 14, AS 1.2 = 16.8 | M (3.5) | 이동속도 30% 둔화, 공격속도 20% 둔화, 3초 지속 |

> **[비평 반영]** 화염마법사 DPS 5→15로 상향. 기본 마법사(12 DPS)보다 확실히 강하게 조정.

#### 폭탄비버 업그레이드

| 업그레이드 | 비용 | ATK | AS/간격 | 사거리 | 특수효과 |
|---|---|---|---|---|---|
| 통나무타워 | 160g | 17 | 3초마다 | 경로 직선 | 경로를 따라 통나무 굴림, 경로상 모든 적 타격 |
| 박격포타워 | 160g | 25 | 0.7 | XL (7.0) | 장거리 광역(반경 2.0), 최대 10체 |

> **[비평 반영]** 박격포 "전체범위"를 XL(7.0)로 구체화. 통나무는 경로 직선으로 특수 메커니즘 명확화.

### 4.5 전사비버 상세 메커니즘 (킹덤러쉬 방식)
- 타워에서 강 위 **집결지점**으로 병사 파견
- 집결지점은 타워 반경 2.0 내에서 플레이어가 드래그로 이동 가능
- 병사는 집결지점 근처를 지나가는 적을 **차단** (적이 멈추고 교전)
- 병사 사망 시 **30초 후 리스폰** (이미 살아있으면 리스폰하지 않음)
- 복수 적 교전 시: 1명의 병사가 1명의 적과 1:1 교전
- 병사 공격속도: 1.0 (초당 1회)

---

## 5. 적(사나워진 동물) 시스템

### 5.1 데미지 계산 공식
```
실제 데미지 = max(1, 공격력 - 해당 방어력)
- 물리공격 → 물리방어력(DEF)으로 감소
- 마법공격 → 마법방어력(MDEF)으로 감소
- 독 데미지 → 방어력 무시 (고정 데미지)
```

### 5.2 적 상세 스탯

| 적 | HP | SPD | ATK 타입 | ATK | AS | DEF | MDEF | 골드 | 특수 |
|---|---|---|---|---|---|---|---|---|---|
| 피라냐 | 10 | 5 | 물리 | 1 | 1.0 | 0 | 0 | 1 | 기본 유닛 |
| 메기 | 20 | 7 | 물리 | 5 | 1.0 | 0 | 0 | 5 | - |
| 이구아나 | 24 | 8 | 마법 | 8 | 1.2 | 0 | 0 | 5 | 마법 공격 |
| 물뱀 | 20 | 30 | 물리 | 7 | 1.5 | 0 | 0 | 10 | 고속 |
| 거북 | 50 | 4 | 물리 | 30 | 0.8 | 5 | 0 | 15 | 높은 방어력 |
| 아나콘다 | 70 | 12 | 물리 | 40 | 1.2 | 5 | 1 | 30 | **보스**, 타워 디버프 |
| 크로커다일 | 80 | 14 | 물리 | 55 | 1.0 | 4 | 0 | 50 | 높은 공격력 |
| 하마 | 100 | 7 | 마법 | 50 | 0.8 | 7 | 3 | 70 | 마법 공격, 높은 방어 |
| 코끼리 | 500 | 10 | 물리 | 100 | 1.0 | 20 | 8 | 100 | **최종보스** |

> **[비평 반영]**
> - 메기: AS 1.0 추가, 골드 12→5로 조정 (이구아나와 동급)
> - 코끼리: SPD 15→10으로 하향 (크로커다일보다 느리게), MDEF 0→8 추가 (마법사 스택 방지)

### 5.3 보스 특수 능력
- **아나콘다** (Stage 5 보스): 크기 2배. 지나가는 길목 반경 3.0 내 타워의 공격속도를 0.3 감소시키는 디버프 오라 (아나콘다가 범위 밖으로 나가면 해제)
- **코끼리** (Stage 10 최종보스): 크기 4배. 특수 능력 없음 (순수 스탯으로 압도)

### 5.4 스폰 메커니즘
- **혼합 스폰**: 약한 적(피라냐, 메기)은 0.3초 간격 빠른 연속 스폰, 강한 적(거북, 크로커다일, 하마)은 1.5초 간격, 보스는 Wave 마지막에 단독 스폰
- 같은 Wave 내 여러 종류의 적은 섞여서 나옴

---

## 6. 스테이지 & Wave 구성

> 10스테이지 = 한 게임. 골드/타워 유지.

### Stage 1
| Wave | 피라냐 |
|---|---|
| 1 | 25 |
| 2 | 35 |
| 3 | 50 |

### Stage 2
| Wave | 피라냐 | 메기 |
|---|---|---|
| 1 | 30 | 8 |
| 2 | 40 | 12 |
| 3 | 50 | 15 |

### Stage 3
| Wave | 피라냐 | 메기 | 이구아나 |
|---|---|---|---|
| 1 | 35 | 10 | 6 |
| 2 | 40 | 12 | 10 |
| 3 | 50 | 15 | 12 |

### Stage 4 (보너스 +200골드)
| Wave | 피라냐 | 메기 | 이구아나 | 물뱀 |
|---|---|---|---|---|
| 1 | 40 | 12 | 8 | 5 |
| 2 | 50 | 15 | 10 | 8 |
| 3 | 60 | 15 | 12 | 12 |

### Stage 5 (보스: 아나콘다)
| Wave | 피라냐 | 메기 | 이구아나 | 물뱀 | 거북 | 아나콘다 |
|---|---|---|---|---|---|---|
| 1 | 60 | 15 | 10 | 10 | 4 | - |
| 2 | 70 | 12 | 8 | 12 | 6 | - |
| 3 | 80 | 10 | - | 8 | 4 | **1** |

### Stage 6
| Wave | 피라냐 | 메기 | 이구아나 | 물뱀 | 거북 |
|---|---|---|---|---|---|
| 1 | 70 | 15 | 10 | 10 | 8 |
| 2 | 80 | 12 | 10 | 12 | 10 |
| 3 | 100 | - | 8 | 12 | 12 |

### Stage 7
| Wave | 피라냐 | 메기 | 이구아나 | 물뱀 | 거북 | 크로커다일 |
|---|---|---|---|---|---|---|
| 1 | 80 | - | 8 | 12 | 10 | 4 |
| 2 | 100 | 15 | - | 10 | 10 | 8 |
| 3 | 100 | - | - | 12 | 12 | 10 |

### Stage 8
| Wave | 피라냐 | 물뱀 | 거북 | 크로커다일 | 하마 |
|---|---|---|---|---|---|
| 1 | 100 | 12 | 10 | 8 | 3 |
| 2 | 100 | 10 | 10 | 10 | 6 |
| 3 | 120 | - | 12 | 12 | 8 |

### Stage 9 (보너스 +400골드)
| Wave | 피라냐 | 이구아나 | 물뱀 | 거북 | 크로커다일 | 하마 |
|---|---|---|---|---|---|---|
| 1 | 120 | - | 15 | 10 | 12 | 8 |
| 2 | 150 | - | 12 | 12 | 15 | 10 |
| 3 | 150 | 10 | 15 | - | 15 | 12 |

### Stage 10 (최종보스: 코끼리)
| Wave | 피라냐 | 물뱀 | 거북 | 크로커다일 | 하마 | 코끼리 |
|---|---|---|---|---|---|---|
| 1 | 150 | 15 | 12 | 15 | 10 | - |
| 2 | 200 | 12 | 10 | 15 | 12 | - |
| 3 | 200 | 10 | 8 | 10 | 8 | **1** |

---

## 7. 골드 경제

| 항목 | 값 |
|---|---|
| 시작 골드 | 220 |
| Stage 4 시작 보너스 | +200 |
| Stage 9 시작 보너스 | +400 |
| 적 처치 보상 | 적별 골드 표 참조 |
| 타워 판매 | 총 투자금의 50% |

---

## 8. UI/UX 설계

### 8.1 시작 화면
- 게임 타이틀 로고 ("비버들의 댐막기 대작전")
- **시작** 버튼
- **설정** 버튼 (BGM/효과음 볼륨)
- **최고 기록** (별 평가 히스토리)
- **크레딧**

### 8.2 게임 HUD
- **상단 좌**: 골드 표시
- **상단 중앙**: 스테이지 / Wave 표시
- **상단 우**: 댐 체력바
- **우측**: 남은 적 수 카운터
- **하단 우**: 일시정지 버튼, 배속 버튼 (1x / 2x)
- **타워 선택 시**: 사거리 범위 원형 표시 + 타워 스탯 정보 패널

### 8.3 타워 UI
- **빈 슬롯**: + 버튼 표시 → 클릭 시 4종 타워 팔레트 (원형 배치, 가격 표시)
- **설치된 타워**: 클릭 시 업그레이드 2갈래 팔레트 + 판매 버튼
- **골드 부족 시**: 해당 선택지 회색 처리 + 가격 빨간색

### 8.4 게임 오버 / 클리어 화면
- **게임 오버**: 댐 파괴 연출 + "게임 오버" + 재시작 버튼
- **클리어**: 별 평가 연출 (1~3별) + 점수 표시 + 재시작/메인 버튼

### 8.5 사운드
- BGM: 메인 화면, 게임 플레이, 보스 등장 (최소 3곡)
- 효과음: 타워 설치, 업그레이드, 판매, 각 타워 공격음, 적 사망, 보스 등장, Wave 시작, 댐 피격, 게임 오버, 클리어

---

## 9. 확장성을 위한 아키텍처 가이드

### 9.1 데이터 드리븐 설계
모든 게임 데이터는 JSON으로 분리:
```
src/data/
  towers.json      # 타워 기본 스탯 + 업그레이드 트리
  enemies.json      # 적 스탯 + 특수 능력
  stages.json       # 스테이지별 Wave 구성
  maps.json         # 맵 경로 웨이포인트 + 타워 슬롯 위치
```

### 9.2 추후 확장 포인트 (구조만 마련)
- **새 맵**: `maps.json`에 새 맵 데이터 추가
- **새 타워/적**: JSON에 데이터 추가 + 스프라이트 에셋 추가
- **난이도 모드**: 적 HP/ATK 배율 계수 파라미터화
- **특수 스킬**: 스킬 시스템 인터페이스 설계 (구현은 추후)
- **멀티플레이어**: 게임 로직 ↔ 렌더링 분리로 서버-클라이언트 전환 가능
- **i18n**: 텍스트를 별도 파일로 관리하여 다국어 지원 가능하게

### 9.3 프로젝트 구조 (예상)
```
beaver/
  src/
    core/           # 게임 루프, 이벤트 시스템
    entities/       # Tower, Enemy, Projectile 등 엔티티
    systems/        # CombatSystem, SpawnSystem, PathSystem 등
    scenes/         # Phaser Scenes (Menu, Game, GameOver)
    ui/             # HUD, 팔레트, 버튼 등 UI 컴포넌트
    data/           # JSON 데이터 파일
    utils/          # 헬퍼 함수
    types/          # TypeScript 타입/인터페이스 정의
  assets/
    sprites/        # 타워, 적, 맵 스프라이트
    audio/          # BGM, 효과음
    fonts/          # 한국어 폰트
  tests/            # Vitest 테스트 파일
  public/           # 정적 파일
```

---

## 10. 비평 피드백 반영 기록

이 섹션은 원본 기획(`plan.md`)에서 비평을 통해 수정/보완된 항목을 기록합니다.

### 수정된 항목

| # | 원본 | 수정 | 이유 |
|---|---|---|---|
| 1 | 화염마법사 DPS 5 | DPS 15 | 업그레이드 시 DPS 하락 문제 해결 |
| 2 | 쇠뇌수 AS 미명시 | AS 1.5 | 구현에 필요한 스탯 보완 |
| 3 | 슈트비버 ATK/HP 미명시 | ATK 7, HP 150 | 구현에 필요한 스탯 보완 |
| 4 | 메기 AS 미명시 | AS 1.0 | 구현에 필요한 스탯 보완 |
| 5 | 기사 DEF 30 | DEF 15 | Stage 5까지 무적 문제 해결 |
| 6 | 코끼리 MDEF 0 | MDEF 8 | 마법사 6기로 7초 킬 방지 |
| 7 | 코끼리 SPD 15 | SPD 10 | 크로커다일(14)보다 빠른 모순 해결 |
| 8 | 메기 골드 12 | 골드 5 | 이구아나(5g) 대비 비정상적 높음 수정 |
| 9 | 타워 사거리 미정의 | S/M/L/XL/MAP 등급 | 구현 필수 스탯 추가 |
| 10 | 광역 범위 미정의 | 반경 + 최대 타격 수 명시 | 구현 필수 스탯 추가 |
| 11 | "아이소메트릭 탑다운" | "3/4 뷰" | 모순되는 표현 통일 |

### 원작자 확인 필요 항목
- [ ] 기사 DEF 30→15 하향 동의 여부
- [ ] 코끼리 MDEF 8 추가 동의 여부
- [ ] 코끼리 SPD 10 하향 동의 여부
- [ ] 메기 골드 12→5 하향 동의 여부
- [ ] 화염마법사 DPS 15 상향 동의 여부
- [ ] 별 평가 산출 공식 동의 여부
- [ ] 세이브 기능 불필요 재확인 (10스테이지 플레이 시간 30분+ 예상)
